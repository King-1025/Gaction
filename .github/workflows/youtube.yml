name: YouTube视频转存

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version: [3.7]

    steps:
    - uses: actions/checkout@v1
    - name: 配置 Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}

        #    - name: 配置缓存依赖
        #uses: actions/cache@v1
        #with:
        #path: ~/.cache/pip
        #key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        #restore-keys: |
        #    ${{ runner.os }}-pip-

    - name: 安装ffmpeg依赖
      run: sudo apt update && apt install ffmpeg -y

    - name: 安装python requests依赖
      run: pip install requests

      #    - name: 列出依赖
      #run: pip list

    - name: 获取视频
      run: ./downloader

    - name: 云盘上传
      run: ./uploader
      env:
         ESC_KEY: ${{ secrets.ESC_KEY }}
         BAIDU_KEY: ${{ secrets.BAIDU_KEY }}

    - name: 发送通知
      run: ./notify
      env: 
         MAIL_KEY: ${{ secrets.MAIL_KEY }}

      #    - name: 下载视频
      #uses: actions/upload-artifact@v1
      #with:
      #  name: video
      #  path: video
